<!DOCTYPE html>
<html>
<head>
    <title>{{query}} at {{source}} {{limit}} {{sort}} - PubTrends</title>
    <meta charset="utf-8">
    <link rel="stylesheet"
          href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
          crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css"
          integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt"
          crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"
            integrity="sha384-tsQFqpEReu7ZLhBV2VZlAu7zcOV+rXbYlF2cqB8txI/8aZajjp4Bqd+V6D5IgvKT"
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
            integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
            crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
            integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
            crossorigin="anonymous"></script>
    <!-- Cytoscape -->
    <script src="https://unpkg.com/cytoscape/dist/cytoscape.min.js"></script>

    <!-- Tippy.js-->
    <script src="https://unpkg.com/popper.js@1.14.7/dist/umd/popper.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/cytoscape-popper@1.0.4/cytoscape-popper.min.js"></script>
    <script src="https://unpkg.com/tippy.js@4.3.5/umd/index.all.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/tippy.js@4.3.5/index.css"/>
    <link rel="stylesheet" href="https://unpkg.com/tippy.js@4.3.5/themes/light.css"/>


    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}?v=1"/>
    <!--     <link rel="stylesheet" href="../static/style.css"/> -->
    <link rel="stylesheet" href="{{ url_for('static', filename='result.css') }}?v=1"/>
    <!--     <link rel="stylesheet" href="../static/result.css"/> -->
    <script src="{{ url_for('static', filename='text_utils.js') }}"></script>
    <!--<script src="../../static/text_utils.js"/>-->
    <script src="{{ url_for('static', filename='feedback.js') }}"></script>
    <!--    <script src="../static/feedback.js"/>-->
    <link rel="stylesheet" href="{{ url_for('static', filename='feedback.css') }}?v=1">
    <!--    <link rel="stylesheet" href="../static/feedback.css"/>-->

    <!-- IntroJS feature tour -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intro.js/2.9.3/introjs.css"
          integrity="sha256-OYXGS5m4oWZAAqoAKpf7Y3bIdzdd9jBfly/xCavEpGw=" crossorigin="anonymous"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/intro.js/2.9.3/intro.js"
            integrity="sha256-SPZP/x8QDPEhRlpJjet4AD5X4ergPWcxjhMn73SwyOE="
            crossorigin="anonymous"></script>

    <!-- Notify.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/notify/0.4.2/notify.min.js"
            integrity="sha512-efUTj3HdSPwWJ9gjfGR71X9cvsrthIA78/Fvd/IN+fttQVy7XWkOAXb295j8B3cmm/kFKVxjiNYzKw9IQJHIuQ=="
            crossorigin="anonymous"></script>

    <script>
        "use strict";

        const CIT_EDGE_STYLE = {
            "width": 0.5,
            "curve-style": "bezier",
            "target-arrow-shape": "triangle",
            "arrow-scale": 0.5,
            "line-color": "#BBBBBB",
            "opacity": 0.2
        };

        const SIM_EDGE_STYLE = {
            "width": function (edge) {
                let data = edge.data();
                if ('similarity' in data) {
                    return (Math.max(5, Math.min(20, data.similarity / 5))) / 5;
                }
                return 1;
            },
            "curve-style": "haystack",
            "line-color": function (edge) {
                let data = edge.data();
                let bibcoupling = 0;
                if ('bibcoupling' in data) {
                    bibcoupling = data.bibcoupling;
                }
                let cocitation = 0;
                if ('cocitation' in data) {
                    cocitation = data.cocitation;
                }
                let citation = 0;
                if ('citation' in data) {
                    citation = data.citation;
                }
                let text = 0;
                if ('text' in data) {
                    text = data.text;
                }
                if (cocitation > 0 && cocitation >= Math.max(bibcoupling, citation, text)) {
                    return "#2ECC71" //214, 234, 248
                }
                if (bibcoupling > 0 && bibcoupling >= Math.max(cocitation, citation, text)) {
                    return "#9B59B6"; //218, 247, 166
                }
                if (citation > 0 && citation >= Math.max(cocitation, bibcoupling, text)) {
                    return "#3498DB"; //235, 222, 240
                }
                return "#BDC3C7";
            },
            "opacity": 0.1
        };

        function rgbToHex(r, g, b) {
            return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
        }

        function showTopics() {
            cy.nodes().forEach(function (ele) {
                if ('title' in ele.data()) {
                    ele.removeClass('topic year');
                    ele.addClass('topic');
                }
            });
            // Close all notifications
            $('.notifyjs-wrapper').trigger('notify-hide');
        }

        function showYear() {
            cy.nodes().forEach(function (ele) {
                if ('title' in ele.data()) {
                    ele.removeClass('topic year');
                    ele.addClass('year');
                }
            });
            // Close all notifications
            $('.notifyjs-wrapper').trigger('notify-hide');
            $.notify({
                title:
                    $('<p><small>' +
                        '<svg width="16" height="16"><rect width="16" height="16" style="fill:#000000;"/></svg> ' +
                        window.min_year + ' - ' +
                        '<svg width="16" height="16"><rect width="16" height="16" style="fill:#00FF00;"/></svg> ' +
                        window.max_year +
                        '</small></p>')
            }, {
                style: 'html_title',
                autoHide: false,
                position: 'bottom right',
                showDuration: 0,
                hideDuration: 0,
                clickToHide: false
            });
        }

        $(window).on("load", function () {
            document.getElementById('cy').innerHTML = "";

            // Disable formatter for the next section because of injections.
            // Enable formatter control in File > Settings > Editor > Code Style
            // @formatter:off
                const citation_graph = {{ citation_graph }};
                const topics_palette = window.topics_palette = JSON.parse({{ topics_palette_json | tojson }});
                const topics_description = JSON.parse({{topics_description_json | tojson }});
                const elements = JSON.parse({{ graph_cytoscape_json | tojson }});
                // @formatter:on

            let edge_style;
            if (citation_graph) {
                edge_style = CIT_EDGE_STYLE;
            } else {
                edge_style = SIM_EDGE_STYLE;
            }

            // Compute min/max params for palette
            let min_year = 3000;
            let max_year = 0;
            let min_cited = 100000;
            let max_cited = 0;
            elements['nodes'].forEach(function (ele) {
                let data = ele['data'];
                if ('year' in data) {
                    min_year = Math.min(data.year, min_year);
                    max_year = Math.max(data.year, max_year);
                }
                if ('cited' in data) {
                    min_cited = Math.min(data.cited, min_cited);
                    max_cited = Math.max(data.cited, max_cited);
                }
            });
            // Save variables
            window.min_year = min_year;
            window.max_year = max_year;
            window.min_cited = min_cited;
            window.max_cited = max_cited;

            //add a new style 'html_title'
            $.notify.addStyle('html_title', {
                html: "<div class='title' data-notify-html='title'/>"
            });

            let cy = window.cy = cytoscape({
                container: document.getElementById('cy'),
                layout: {
                    name: 'preset',
                    animate: false
                },
                style: [
                    {
                        selector: "node",
                        style: {
                            "width": function (node) {
                                const data = node.data();
                                if ('cited' in data) {
                                    return data.cited * 20 / max_cited + 5;
                                } else {
                                    return 5;
                                }
                            },
                            "height": function (node) {
                                const data = node.data();
                                if ('cited' in data) {
                                    return data.cited * 20 / max_cited + 5;
                                } else {
                                    return 5;
                                }
                            },
                            "border-width": 0.5,
                            "border-color": "black",
                            "opacity": 0.7,
                        }
                    },
                    <!-- In case of Paper Analyzer highlight analyzed paper -->
                    {
                        selector: 'node.analyzed',
                        style: {
                            'border-width': '1.0',
                            'opacity': '1.0 !important'
                        }
                    },
                    {
                        selector: "node.topic",
                        style: {
                            "background-color": function (node) {
                                let data = node.data();
                                if ('topic' in data) {
                                    return topics_palette[data.topic];
                                } else {
                                    return '#FFFFFF'
                                }
                            },
                        }
                    },
                    {
                        selector: "node.year",
                        style: {
                            "background-color": function (node) {
                                let data = node.data();
                                if ('year' in data) {
                                    let dy;
                                    if (max_year > min_year) {
                                        dy = (data.year - min_year) / (max_year - min_year);
                                    } else {
                                        dy = 1;
                                    }
                                    return rgbToHex(0, Math.floor(255 * dy), 0);
                                } else {
                                    return "#FFFFFF"
                                }
                            },
                        }
                    },
                    {
                        selector: 'node.highlight',
                        style: {
                            'border-width': '1.0',
                            'opacity': '1.0 !important'
                        }
                    },
                    {
                        selector: 'node.semitransp',
                        style: {
                            'opacity': 0.1
                        }
                    },
                    {
                        selector: "edge",
                        style: edge_style
                    },
                    {
                        selector: 'edge.highlight',
                        style: {
                            'width': '1.0 !important',
                            'opacity': '1.0 !important'
                        }
                    },
                    {
                        selector: 'edge.semitransp',
                        style: {
                            'opacity': '0.01 !important'
                        }
                    },
                ],
                elements: elements,
                // interaction options
                minZoom: 1e-1,
                maxZoom: 1e1,
                boxSelectionEnabled: false,
            });

            function makePopper(ele) {
                let ref = ele.popperRef(); // used only for positioning

                ele.tippy = tippy(ref, { // tippy options:
                    theme: 'light',
                    content: () => {
                        let content = document.createElement('div');
                        let data = ele.data();
                        if ('similarity' in data) {
                            // Graph similarity
                            let bibcoupling = 0;
                            if ('bibcoupling' in data) {
                                bibcoupling = data.bibcoupling;
                            }
                            let cocitation = 0;
                            if ('cocitation' in data) {
                                cocitation = data.cocitation;
                            }
                            let citation = 0;
                            if ('citation' in data) {
                                citation = data.citation;
                            }
                            let text = 0;
                            if ('text' in data) {
                                text = data.text;
                            }

                            content.innerHTML = "<p><small>Similarity is computed based on citations " +
                                "and text similarity between papers.<br>" +
                                "The bigger value the more similar papers are." + "<br>" +
                                "<b>Co-citation</b> " + cocitation + "<br>" +
                                "<b>Bibliographic coupling</b> " + bibcoupling + "<br>" +
                                "<b>Citation</b> " + citation + "<br>" +
                                "<b>Text similarity</b> " + Number(text).toFixed(2) + "</small></p>";
                        } else if ('title' in data) {
                            // Paper
                            // Disable formatter for the next section because of injections.
                            // Enable formatter control in File > Settings > Editor > Code Style
                            // @formatter:off
                            content.innerHTML = "<p><small>" +
                                "<b>" + data.title + "</b><br>" +
                                "<b>Author(s)</b> " + data.authors + "<br>" +
                                "<b>Journal</b> " + data.journal + "<br>" +
                                "<b>Year</b> " + data.year + "<br>" +
                                "<b>Cited</b> " + data.cited + "<br>" +
                                "<b>Mesh</b> " + data.mesh + "<br>" +
                                "<b>Keywords</b> " + data.keywords + "<br>" +
                                "<b>Topic</b> " + (data.topic + 1) + " " +
                                '<svg width="16" height="16"><rect width="16" height="16" ' +
                                'style="fill:' + topics_palette[data.topic] + '";/></svg> ' +
                                topics_description[data.topic] +
                                "</small></p>";
                            }
                            // @formatter:on
                        return content;
                    },
                    trigger: 'manual' // manual mode is required here, because of cytoscape
                });
                return ele.tippy;
            }

            // Topic based colouring by default
            showTopics();

            // Save all created tippy
            let tippys = [];

            function addPopper(popperElements) {
                popperElements.forEach(function (ele) {
                    tippys.push(makePopper(ele));
                    ele.unbind('mouseover');
                    // track hovered event to avoid too late tippy
                    let inside = false;
                    ele.bind('mouseover', (event) => {
                        inside = true;
                        // Show hover after two seconds
                        setTimeout(
                            function () {
                                if (inside) {
                                    event.target.tippy.show();
                                }
                            },
                            1000
                        );
                    });
                    ele.unbind('mouseout');
                    ele.bind('mouseout', (event) => {
                        inside = false;
                        event.target.tippy.hide();
                    })
                });
            }

            cy.ready(function () {
                // Add info popup on hover
                if (citation_graph) {
                    addPopper(cy.nodes());
                } else {
                    addPopper(cy.nodes().filter(function (ele) {
                        return 'topic' in ele.data();
                    }));
                    addPopper(cy.edges().filter(function (ele) {
                        return 'similarity' in ele.data();
                    }));
                }
                // Open paper details on click
                cy.nodes().on('click', function (event) {
                    let data = event.target.data();
                    if ('title' in data) {
                        event.stopPropagation();
                        // Decode jobid from URL
                        const jobid = new URL(window.location).searchParams.get('jobid');
                        window.open('/paper?source={{source}}&id=' + data.id + '&jobid=' + jobid, '_blank');
                    }
                });
                // Highlight node and neighbours on hover
                cy.on('mouseover', 'node', function (event) {
                    if (window.freeze || getFilter() !== "") {
                        return;
                    }
                    let sel = event.target;
                    if ('title' in sel.data()) {
                        sel.addClass('highlight');
                        sel.removeClass('semitransp');
                        let neighborEdges = sel.connectedEdges();
                        let neighborNodes = neighborEdges.connectedNodes();
                        cy.nodes().filter(function (ele) {
                            return ele !== sel;
                        }).difference(neighborNodes).addClass('semitransp');
                        neighborEdges.addClass('highlight');
                        cy.edges().difference(neighborEdges).addClass('semitransp');
                        neighborNodes.addClass('highlight');
                    }
                });
                cy.on('mouseout', 'node', function (event) {
                    if (window.freeze || getFilter() !== "") {
                        return;
                    }
                    let sel = event.target;
                    if ('title' in sel.data()) {
                        sel.removeClass('highlight');
                        sel.removeClass('semitransp');
                        let neighborEdges = sel.connectedEdges();
                        let neighborNodes = neighborEdges.connectedNodes();
                        neighborNodes.removeClass('highlight');
                        cy.nodes().filter(function (ele) {
                            return ele !== sel;
                        }).difference(neighborNodes).removeClass('semitransp');
                        neighborEdges.removeClass('highlight');
                        cy.edges().difference(neighborEdges).removeClass('semitransp');
                    }
                });

                // Highlight edges and neighbours on hover
                cy.on('mouseover', 'edge', function (event) {
                    if (window.freeze || getFilter() !== "") {
                        return;
                    }
                    let sel = event.target;
                    sel.addClass('highlight');
                    let neighborNodes = sel.connectedNodes();
                    cy.nodes().filter(function (ele) {
                        return ele !== sel && ele.hasClass('dataset');
                    }).difference(neighborNodes).addClass('semitransp');
                    cy.edges().difference(sel).addClass('semitransp');
                    neighborNodes.addClass('highlight');
                });
                cy.on('mouseout', 'edge', function (event) {
                    if (window.freeze || getFilter() !== "") {
                        return;
                    }
                    let sel = event.target;
                    sel.removeClass('highlight');
                    let neighborNodes = sel.connectedNodes();
                    neighborNodes.removeClass('highlight');
                    cy.nodes().filter(function (ele) {
                        return ele !== sel && ele.hasClass('dataset');
                    }).difference(neighborNodes).removeClass('semitransp');
                    sel.removeClass('highlight');
                    cy.edges().difference(sel).removeClass('semitransp');
                });

                <!-- Highlight analyzed paper -->
                if ("{{ limit }}" === "related" && "{{ sort }}" === "papers") {
                    let title = normalize('{{ query }}');
                    if (title.endsWith("...")) {
                        title = title.replace("...", "");
                    }
                    cy.nodes().forEach(function (ele) {
                        let data = ele.data();
                        if ('title' in data) {
                            if (data.title.startsWith(title)) {
                                ele.addClass('analyzed');
                            }
                        }
                    });
                }
            });
            window.freeze = false;
            // Close all tippy
            $(document).keyup(function (event) { // keyprocess doesn't handle escape key
                if (event.keyCode === 27) { // Escape
                    tippys.forEach((e) => e.hide());
                    if (window.freeze) {
                        // Unfreeze hover highlighting
                        window.freeze = false;
                        searchChanged();
                        $.notify("Escape pressed. Revert to normal highlighting mode.", {
                            className: "success",
                            position: "bottom right"
                        });
                    }
                }
            });
            $(document).keypress(function (event) {
                if (event.keyCode === 70 || event.keyCode === 102) { // F or f
                    if (!window.freeze) {
                        window.freeze = true;  // Freeze hover highlighting
                        $.notify("F pressed. Switched to fixed highlighting mode. Use Escape to undo.", {
                            className: "success",
                            position: "bottom right"
                        });
                    }
                }
            });

            // Connections between topics
            let topicsConnections = new Set();
            cy.edges().forEach(function (ele) {
                let data = ele.data();
                let sourceData = cy.nodes().filter(ele => ele.data().id === data.source).first().data();
                let targetData = cy.nodes().filter(ele => ele.data().id === data.target).first().data();
                if ('topic' in sourceData && 'topic' in targetData && sourceData.topic !== targetData.topic) {
                    topicsConnections.add(ele);
                }
            });

            $('#connectTopics').change(
                function () {
                    if ($(this).is(':checked')) {
                        topicsConnections.forEach(ele => cy.add(ele));
                    } else {
                        cy.remove(cy.edges().filter(ele => topicsConnections.has(ele)));
                    }
                });

            $('#searchTitles').change(searchChanged);
            $('#searchAbstracts').change(searchChanged);
            $('#searchAuthors').change(searchChanged);
            $('#searchJournals').change(searchChanged);
            $('#searchMesh').change(searchChanged);
            $('#searchKeywords').change(searchChanged);

        });

        function getFilter() {
            return $.trim($("#search-input").val()).toLowerCase();
        }

        function searchChanged() {
            const filter = getFilter();
            if (filter === "") {
                window.cy.nodes().filter(function (ele) {
                    return 'title' in ele.data();
                }).forEach(function (ele) {
                    ele.removeClass('highlight');
                    ele.removeClass('semitransp');
                });
                return
            }
            window.cy.nodes().forEach(function (ele) {
                let data = ele.data();
                if ('title' in data) {
                    if ($('#searchTitles').is(':checked') && data.title.toLowerCase().includes(filter) ||
                        $('#searchJournals').is(':checked') && data.journal.toLowerCase().includes(filter) ||
                        $('#searchAuthors').is(':checked') && data.authors.toLowerCase().includes(filter) ||
                        $('#searchAbstracts').is(':checked') && data.abstract.toLowerCase().includes(filter) ||
                        $('#searchMesh').is(':checked') && data.mesh.toLowerCase().includes(filter) ||
                        $('#searchKeywords').is(':checked') && data.keywords.toLowerCase().includes(filter)) {
                        ele.removeClass('semitransp');
                        ele.addClass('highlight');
                    } else {
                        ele.removeClass('highlight');
                        ele.addClass('semitransp');
                    }
                }
            });
        }

        function result() {
            const url = '/result?query=' + normalize('{{ query }}') + '&source={{source}}&limit={{limit}}&sort={{sort}}';
            // Decode jobid from URL
            const jobid = new URL(window.location).searchParams.get('jobid');
            window.open(url + '&jobid=' + jobid, '_blank');
        }

        $(document).ready(function () {
            createClickableFeedBackFormNoMessage("feedback-graph-html-form", "feedback-graph-html")

            setTimeout(function () {
                $.notify("See About for quick introduction.", {
                    className: "success",
                    position: "bottom right",
                    autoHideDelay: 15000
                });
            }, 5000);
        });

    </script>
</head>

<body>
<!-- Fixed navbar -->
<nav class="navbar navbar-light bg-light fixed-top border-bottom no-padding-right">
    <div class="row container-fluid no-padding-right">
        <div class="col no-padding">
            <div class="row ml-3">
                <a id="pubtrends" class="navbar-brand vertical-center" href="/">PubTrends</a>
                <ol class="breadcrumb bg-light search-query col-auto">
                    <li class="breadcrumb-item vertical-center">{{ source }}</li>
                    <li class="breadcrumb-item vertical-center">
                        <a id="result" href="javascript:void(0);" class="link" onclick="result();"><strong>{{ query
                            }}</strong></a>
                    </li>
                    <li class="breadcrumb-item vertical-center">{{ limit }} {{ sort }}</li>
                </ol>
                <div class="col justify-content-end row">
                    <div class="col-auto">
                        <div class="col-auto">
            <span class="d-flex align-items-center">
                <input id="search-input" type="text" class="form-control" style="min-width: 100px;"
                       placeholder="Search..." aria-label="Search for..."
                       oninput="searchChanged();"/>
                &nbsp;in

                <input type="checkbox" id="searchTitles" class="ml-3 mr-2" checked="checked"/>
                <label style="margin: auto" for="searchTitles">Titles</label>

                <input type="checkbox" id="searchAbstracts" class="ml-3 mr-2" checked="checked"/>
                <label style="margin: auto" for="searchAbstracts">Abstracts</label>

                <input type="checkbox" id="searchAuthors" class="ml-3 mr-2"/>
                <label style="margin: auto" for="searchAuthors">Authors</label>

                <input type="checkbox" id="searchJournals" class="ml-3 mr-2"/>
                <label style="margin: auto" for="searchJournals">Journals</label>

                <input type="checkbox" id="searchMesh" class="ml-3 mr-2"/>
                <label style="margin: auto" for="searchMesh">Mesh</label>

                <input type="checkbox" id="searchKeywords" class="ml-3 mr-2"/>
                <label for="searchKeywords" style="margin: auto">Keywords</label>
            </span>
                        </div>
                    </div>
                    <div class="dropdown col-auto no-padding mr-2">
                        <button class="btn btn-secondary dropdown-toggle" type="button"
                                id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true"
                                aria-expanded="false">
                            View
                        </button>
                        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                            <a class="dropdown-item" onclick="showTopics();" href="javascript:void(0);">Topic</a>
                            <a class="dropdown-item" onclick="showYear();" href="javascript:void(0);">Year</a>
                            <hr>
                            {% if citation_graph != 'true' %}
                            <div class="dropdown-item">
                                <input type="checkbox" id="connectTopics" checked="checked">
                                <label for="connectTopics">Connect topics</label>
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <a class="btn btn-secondary col-auto mr-3" content="About"
                       href="javascript:void(0);" onclick="startIntro();">About</a>
                </div>
            </div>
        </div>
    </div>
</nav>
<div class="container-fluid">
    <div id="cy" role="main" style="height: 85vh; margin-bottom: 2rem">Loading...</div>
</div>
<footer class="container">
    <div class="row">
        <div class="col-4">
            <div id="feedback-graph-html-form" class="float-left vertical-center"></div>
        </div>
        <div class="col-4">
            <p>version {{ version }}<br/>
                &copy; 2021 <a href="https://research.jetbrains.org/groups/biolabs"
                               title="JetBrains Research BioLabs"
                               target="_blank">JetBrains Research</a>
            </p>
        </div>
        <div class="col-4"></div>
    </div>
</footer>
<script type="text/javascript">
    function startIntro() {
        var intro = introJs();
        // Disable formatter for the next section because of injections.
        // Enable formatter control in File > Settings > Editor > Code Style
        // @formatter:off
            // Boolean value if we are visualizing citations graph (true) of similarity graph (false)
            const citation_graph = {{ citation_graph }};
            // @formatter:on

        let description;
        if (citation_graph) {
            description = "Citations graph shows citations among papers.<br>" +
                "Papers are visualized as nodes, citations as edges. " +
                "Node size encodes citations count. See Color menu for node color options.<br>" +
                "Similar papers are highlighted on hover.<br>" +
                "Use <strong>F</strong> to freeze highlighting, <strong>Escape</strong> to unfreeze."
        } else {
            description = "Similarity graph represents similarity among papers.<br>" +
                "Papers are visualized as nodes, similarities as edges. " +
                "Node size shows paper citations count, see Color menu for node colors options. <br>" +
                "Edge width shows papers similarity, the thicker the more similar papers are.<br>" +
                "Similar papers are highlighted on hover.<br>" +
                "Use <strong>F</strong> to freeze highlighting, <strong>Escape</strong> to unfreeze.<br>" +
                "Edge color - similarity type.<br>" +
                '<svg width="16" height="16"><rect width="16" height="16" style="fill:rgba(46,204,113,0.5);"/></svg>' +
                "&nbsp;<em>Co-citation</em>" +
                "<br>" +
                '<svg width="16" height="16"><rect width="16" height="16" style="fill:rgba(155,89,182,0.5);"/></svg>' +
                "&nbsp;<em>Bibliographic coupling</em> " +
                "<br>" +
                '<svg width="16" height="16"><rect width="16" height="16" style="fill:rgba(52,152,219,0.5);"/></svg>' +
                "&nbsp;<em>Citation</em>" +
                "<br>" +
                '<svg width="16" height="16"><rect width="16" height="16" style="fill:rgba(189,195,199,0.5);"/></svg>' +
                "&nbsp;<em>Text similarity</em>";
        }
        intro.setOptions({
            steps: [
                {
                    intro: description
                },
                {
                    element: '#result',
                    intro: "Open full analysis report.<br>" +
                        "Learn more about topics, most cited papers, etc."
                },
                {
                    element: '#search-input',
                    intro: 'Search papers containing text in title, abstracts, etc.'
                },
                {
                    element: '#dropdownMenuButton',
                    intro: 'Change graph view.<br>' +
                        'Colors can represent topics or publication year.<br>' +
                        '<svg width="16" height="16"><rect width="16" height="16" style="fill:#000000;"/></svg> min - ' +
                        '<svg width="16" height="16"><rect width="16" height="16" style="fill:#00FF00;"/></svg> max<br>' +
                        'Connect topics: whether edges between different topics are shown.'
                }
            ]
        });
        intro.start();
    }
</script>
</body>
</html>