<!DOCTYPE html>
<html>
<head>
    <title>{{query}} at {{source}}{{ search_string }} {{limit}} {{sort}} - PubTrends</title>
    <meta charset="utf-8">
    <link rel="stylesheet"
          href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
          crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css"
          integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt"
          crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"
            integrity="sha384-tsQFqpEReu7ZLhBV2VZlAu7zcOV+rXbYlF2cqB8txI/8aZajjp4Bqd+V6D5IgvKT"
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
            integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
            crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
            integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
            crossorigin="anonymous"></script>
    <script src="https://cdn.bokeh.org/bokeh/release/bokeh-2.0.2.min.js"
            crossorigin="anonymous"></script>
    <script src="https://cdn.bokeh.org/bokeh/release/bokeh-widgets-2.0.2.min.js"
            crossorigin="anonymous"></script>

    <!-- DataTables with search -->
    <script src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.21/js/dataTables.bootstrap4.min.js"></script>
    <link href="https://cdn.datatables.net/1.10.21/css/dataTables.bootstrap4.min.css"
          rel="stylesheet" type="text/css">
    <!-- DataTables search highlight -->
    <script src="https://cdn.jsdelivr.net/g/mark.js(jquery.mark.min.js)"></script>
    <script src="https://cdn.datatables.net/plug-ins/1.10.13/features/mark.js/datatables.mark.js"></script>
    <link href="https://cdn.datatables.net/plug-ins/1.10.13/features/mark.js/datatables.mark.min.css"
          type="text/css">


    <!-- IntroJS feature tour -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intro.js/2.9.3/introjs.css"
          integrity="sha256-OYXGS5m4oWZAAqoAKpf7Y3bIdzdd9jBfly/xCavEpGw=" crossorigin="anonymous"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/intro.js/2.9.3/intro.js"
            integrity="sha256-SPZP/x8QDPEhRlpJjet4AD5X4ergPWcxjhMn73SwyOE="
            crossorigin="anonymous"></script>

    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}?v=1"/>
    <!--     <link rel="stylesheet" href="../static/style.css"/> -->
    <link rel="stylesheet" href="{{ url_for('static', filename='result.css') }}?v=1">
    <!--    <link rel="stylesheet" href="../static/result.css"/>-->
    <script src="{{ url_for('static', filename='wordcloud.js') }}"></script>
    <!--    <script src="../static/wordcloud.js"/>-->
    <!-- Notify.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/notify/0.4.2/notify.min.js"
            integrity="sha512-efUTj3HdSPwWJ9gjfGR71X9cvsrthIA78/Fvd/IN+fttQVy7XWkOAXb295j8B3cmm/kFKVxjiNYzKw9IQJHIuQ=="
            crossorigin="anonymous"></script>
    <script src="{{ url_for('static', filename='feedback.js') }}"></script>
    <!--    <script src="../static/feedback.js"/>-->

    <script>
        "use strict";

        function papers_callback_impl(key, value) {
            const url = '/papers?query=' + escape('{{ query }}') + '&source={{source}}&limit={{limit}}&sort={{sort}}';
            // Decode jobid from URL
            const jobid = new URL(window.location).searchParams.get('jobid');
            let args = '';
            if (key != null) {
                args = '&' + key + '=' + value;
            }
            window.open(url + args + '&jobid=' + jobid, '_blank');
        }

        function papers_callback() {
            papers_callback_impl(null, null)
        }

        function papers_callback_component(comp) {
            papers_callback_impl('comp', comp)
        }

        function papers_callback_word(word) {
            papers_callback_impl('word', word)
        }

        function papers_callback_author(author) {
            papers_callback_impl('author', author)
        }

        function papers_callback_journal(journal) {
            papers_callback_impl('journal', journal)
        }

        function papers_callback_top_papers() {
            papers_callback_impl('papers_list', 'top')
        }

        function papers_callback_papers_of_the_year() {
            papers_callback_impl('papers_list', 'year')
        }

        function papers_callback_hot_papers() {
            papers_callback_impl('papers_list', 'hot')
        }

        function graph_callback(graphType) {
            const url = '/graph?query=' + escape('{{ query }}') + '&source={{source}}&limit={{limit}}&sort={{sort}}';
            // Decode jobid from URL
            const jobid = new URL(window.location).searchParams.get('jobid');
            window.open(url + '&type=' + graphType + '&jobid=' + jobid, '_blank');
        }

        function review_callback(papersNumber, sentsNumber) {
            const url = '/generate_review?query=' + escape('{{ query }}') + '&source={{source}}&limit={{limit}}&sort={{sort}}';
            // Decode jobid from URL
            const jobid = new URL(window.location).searchParams.get('jobid');
            window.open(url + '&papers_number=' + papersNumber + '&sents_number=' + sentsNumber + '&jobid=' + jobid, '_blank');
        }


        $(document).ready(function () {
            // Mark search by default in datatables
            $.extend(true, $.fn.dataTable.defaults, {
                mark: true
            });

            // Setup datatables
            $('#authors-table').DataTable();
            $('#journals-table').DataTable();
            {% if topic_evolution is defined %}
                $('#topic_evolution_keywords').DataTable();
            {% endif %}

            // Enable search for numbers only in numbers table
            {% if numbers is defined %}
                // disable search on the first column
                $('#numbers-table').DataTable({
                    "columnDefs": [
                        { "searchable": false, "targets": 1 }
                    ]
                });
            {% endif %}

            // Process main word cloud
            let words = JSON.parse('{{ papers_word_cloud }}'.replace(/&#34;/g, '"').replace(/&#39;/g, '\'').replace(/&amp;/g, '&'));
            process_word_cloud('papers_word_cloud', 220, 335, words, papers_callback_word);

            // Process topics word clouds
            {% for (script, div), word_cloud, zoom_in_callback in topics_info_and_word_cloud_and_callback %}
                 words = JSON.parse('{{ word_cloud }}'.replace(/&#34;/g, '"').replace(/&#39;/g, '\'').replace(/&amp;/g, '&'));
                 process_word_cloud('topic_word_cloud_{{ loop.index }}', 220, 335, words, papers_callback_word);
            {% endfor %}

            // Configure jobid for feedback
            // Decode jobid from URL
            const jobid = new URL(window.location).searchParams.get('jobid');
            $('#feedback-jobid').val(jobid);

            setTimeout(function() {
                $.notify("See About for quick introduction.", {
                    className: "success",
                    position: "bottom right",
                    autoHideDelay: 15000
                });
            }, 5000);
        });
    </script>
</head>
<body>

<!-- Fixed navbar -->
<nav class="navbar navbar-light bg-light fixed-top border-bottom no-padding-right">
    <div class="row container-fluid no-padding-right">
        <div class="col-lg-1 col-xl-2 no-padding">
            <a id="pubtrends" class="navbar-brand" href="/">PubTrends</a>
        </div>
        <div class="col-lg-11 col-xl-8">
            <div class="content">
                <ol class="breadcrumb bg-light search-query">
                    <li class="breadcrumb-item">{{ source }}</li>
                    <li class="breadcrumb-item"><strong>{{ query }}</strong></li>
                    <li class="breadcrumb-item">{{ limit }} {{ sort }}</li>
                </ol>
            </div>
        </div>
        <div class="d-none d-xl-block col-xl-2 float-right no-padding-right">
            <a id="tour-start" class="btn btn-secondary float-right"
               href="javascript:void(0);" onclick="startIntro();">About</a>
        </div>
    </div>
</nav>

<div class="container-fluid">
    <div class="row ">
        <!-- Sticky sidebar -->
        <nav class="d-none d-xl-block d-lg-block col-lg-1 col-xl-2 sidebar no-padding">
            <div class="sidebar-sticky" id="sidebar">
                <ul class="nav flex-column">
                    <li class="nav-item row">
                        <a class="nav-link no-padding-right" href="#overview" title="Overview">
                            <img class="nav-icon" src="{{ url_for('static', filename='home.svg') }}"/>
                        </a>
                        <a class="nav-link d-none d-xl-block no-padding" href="#overview">
                            Overview
                        </a>
                    </li>
                    {% if topics_analyzed %}
                    <li class="nav-item row">
                        <a class="nav-link no-padding-right" href="#highlights" title="Highlights">
                            <img class="nav-icon" src="{{ url_for('static', filename='bar-chart-2.svg') }}"/>
                        </a>
                        <a class="nav-link d-none d-xl-block no-padding" href="#highlights">
                            Highlights
                        </a>
                    </li>
                    <li class="nav-item row">
                        <a class="nav-link no-padding-right" href="#network" title="Network">
                            <img class="nav-icon" src="{{ url_for('static', filename='globe.svg') }}"/>
                        </a>
                        <a class="nav-link d-none d-xl-block no-padding" href="#network">
                            Network
                        </a>
                    </li>
                    <li class="nav-item row">
                        <a class="nav-link no-padding-right" href="#topics" title="Topics">
                            <img class="nav-icon" src="{{ url_for('static', filename='tag.svg') }}"/>
                        </a>
                        <a class="nav-link d-none d-xl-block no-padding" href="#topics">
                            Topics
                        </a>
                    </li>
                    <li class="nav-item row">
                        <a class="nav-link no-padding-right" href="#trends" title="Trends">
                            <img class="nav-icon" src="{{ url_for('static', filename='trending-up.svg') }}"/>
                        </a>
                        <a class="nav-link d-none d-xl-block no-padding" href="#trends">
                            Trends
                        </a>
                    </li>
                    <li class="nav-item row">
                        <a class="nav-link no-padding-right" href="#publications" title="Publications">
                            <img class="nav-icon" src="{{ url_for('static', filename='columns.svg') }}"/>
                        </a>
                        <a class="nav-link d-none d-xl-block no-padding" href="#publications">
                            Publications
                        </a>
                    </li>
                    {% endif %}
                    <li class="nav-item row">
                        <a class="nav-link no-padding-right" href="#authors" title="Authors">
                            <img src="{{ url_for('static', filename='users.svg') }}"/>
                        </a>
                        <a class="nav-link d-none d-xl-block no-padding" href="#authors">
                            Authors
                        </a>
                    </li>
                    <li class="nav-item row">
                        <a class="nav-link no-padding-right" href="#journals" title="Journals">
                            <img class="nav-icon" src="{{ url_for('static', filename='book-open.svg') }}"/>
                        </a>
                        <a class="nav-link d-none d-xl-block no-padding" href="#journals">
                            Journals
                        </a>
                    </li>
                    <li class="nav-item row">
                        <a class="nav-link no-padding-right" href="#numbers" title="Numbers">
                            <img src="{{ url_for('static', filename='hash.svg') }}"/>
                        </a>
                        <a class="nav-link d-none d-xl-block no-padding" href="#numbers">
                            Numbers
                        </a>
                    </li>
                    <li class="nav-item row">
                        <a class="nav-link no-padding-right" href="#evolution" title="Evolution">
                            <img src="{{ url_for('static', filename='compass.svg') }}"/>
                        </a>
                        <a class="nav-link d-none d-xl-block no-padding" href="#evolution">
                            Evolution
                        </a>
                    </li>
                    <li class="nav-item row">
                        <a class="nav-link no-padding-right" href="#review" title="Review">
                            <img class="nav-icon" src="{{ url_for('static', filename='list.svg') }}"/>
                        </a>
                        <a class="nav-link d-none d-xl-block no-padding" href="#review">
                            Review
                        </a>
                    </li>
                    <li class="nav-item row">
                        <a class="nav-link no-padding-right" href="#feedback" title="Feedback">
                            <img class="nav-icon" src="{{ url_for('static', filename='edit.svg') }}"/>
                        </a>
                        <a class="nav-link d-none d-xl-block no-padding" href="#feedback">
                            Feedback
                        </a>
                    </li>
                </ul>
            </div>
        </nav>

        <!-- Main content -->
        <main class="col-lg-11 col-xl-8" role="main">
            <div class="content">
                <div class="card mt-3">
                    <div class="card-title" id="overview">
                        <h2 class="card-header">Overview</h2>
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-sm-4">
                                <div class="card">
                                    <div id="n_papers" class="card-body text-center">
                                        <span class="stats-number"><b>{{ n_papers }}</b></span><br>
                                        <span class="card-text">papers</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-4">
                                <div id="n_citations" class="card">
                                    <div class="card-body text-center">
                                        <span class="stats-number"><b>{{ n_citations }}</b></span><br>
                                        <span class="card-text">citations</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-4">
                                <div id="n_topics" class="card">
                                    <div class="card-body text-center">
                                        <span class="stats-number"><b>{{ n_topics }}</b></span><br>
                                        <span class="card-text">topics</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-3 no-padding-right">
                                <strong>Word cloud</strong>
                                <br>
                                <canvas id="papers_word_cloud" width="0" height="0" style="border:1px solid #eee;">
                                    Canvas is not supported in your browser.
                                </canvas>
                            </div>
                            <div class="col-9 no-padding-left">
                                {% for script, div in papers_stats %}
                                {{ script|safe }}
                                {{ div|safe }}
                                {% endfor %}
                            </div>
                        </div>
                        <div id="search-in-papers" class="row">
                            <div class="col col-auto">
                                <input id="search-input" type="text" class="form-control"
                                       placeholder="Search in papers...">
                            </div>
                            <div class="col col-auto no-padding-left">
                                <button id="search_word" type="button" class="btn btn-light"
                                        onclick="(function(){
                                            papers_callback_word($('#search-input').val().trim())
                                        })();">
                                    <img src="{{ url_for('static', filename='search.svg') }}" alt=""/>&nbsp;Search
                                </button>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-auto">
                                <button id="show_as_list" type="button" class="btn btn-light"
                                        onclick="(function(){ papers_callback() })();">
                                    <img src="{{ url_for('static', filename='list.svg') }}" alt="+"/>&nbsp;Show as list
                                </button>
                            </div>
                        </div>
                        <div class="mt-3">
                            <small class="text-muted">Was this useful?</small>
                            <div id="feedback-overview" class="btn-group-horizontal">
                                <button type="button" class="btn btn-sm btn-feedback-yes"
                                        onclick="feedback(this, 1)">
                                    <img src="{{ url_for('static', filename='smile.svg') }}" alt="Yes"/>
                                </button>
                                <button type="button" class="btn btn-sm btn-feedback-meh"
                                        onclick="feedback(this, 0)">
                                    <img src="{{ url_for('static', filename='meh.svg') }}" alt="Not sure"/>
                                </button>
                                <button type="button" class="btn btn-sm btn-feedback-no"
                                        onclick="feedback(this, -1)">
                                    <img src="{{ url_for('static', filename='frown.svg') }}" alt="No"/>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card mt-3">
                    <div class="card-title" id="highlights">
                        <h1 class="card-header">Highlights</h1>
                    </div>
                    <div class="card-body">
                        <h2 class="card-subtitle">Top Cited Papers</h2>
                        <p>
                            Top 50 cited papers are shown among all the papers for given search query.<br>
                            Year reflects publication year of the original paper.
                        </p>
                        <button type="button" class="btn btn-light"
                                onclick="(function(){ papers_callback_top_papers() })();">
                            <img src="{{ url_for('static', filename='list.svg') }}" alt="+"/>&nbsp;Show as list
                        </button>
                        <div>
                            {% for script, div in top_cited_papers %}
                            {{ script|safe }}
                            {{ div|safe }}
                            {% endfor %}
                        </div>
                        <hr>

                        <h2 class="card-subtitle">Top Cited Papers of the Year</h2>
                        <p>
                            For each year we show the paper which has the most significant number of citations in a
                            given year.<br>
                            Number <i>V</i> means <i>+V</i> gain in citations.<br>
                            Different papers have different colors.
                        </p>
                        <button type="button" class="btn btn-light"
                                onclick="(function(){ papers_callback_papers_of_the_year() })();">
                            <img src="{{ url_for('static', filename='list.svg') }}" alt="+"/>&nbsp;Show as list
                        </button>
                        <div>
                            {% for script, div in max_gain_papers %}
                            {{ script|safe }}
                            {{ div|safe }}
                            {% endfor %}
                        </div>
                        <hr>

                        <h2 class="card-subtitle">Hot Papers</h2>
                        <p>
                            For each year we show a recent paper which has the biggest number of citation since the
                            moment of publication.<br>
                            Number <i>V</i> means <i>*(1 + V)</i> gain in citations.<br>
                            Different papers have different colors.
                        </p>
                        <button type="button" class="btn btn-light"
                                onclick="(function(){ papers_callback_hot_papers() })();">
                            <img src="{{ url_for('static', filename='list.svg') }}" alt="+"/>&nbsp;Show as list
                        </button>
                        <div>
                            {% for script, div in max_relative_gain_papers %}
                            {{ script|safe }}
                            {{ div|safe }}
                            {% endfor %}
                        </div>
                        <div class="mt-3">
                            <small class="text-muted">Was this useful?</small>
                            <div id="feedback-highlights" class="btn-group-horizontal">
                                <button type="button" class="btn btn-sm btn-feedback-yes"
                                        onclick="feedback(this, 1)">
                                    <img src="{{ url_for('static', filename='smile.svg') }}" alt="Yes"/>
                                </button>
                                <button type="button" class="btn btn-sm btn-feedback-meh"
                                        onclick="feedback(this, 0)">
                                    <img src="{{ url_for('static', filename='meh.svg') }}" alt="Not sure"/>
                                </button>
                                <button type="button" class="btn btn-sm btn-feedback-no"
                                        onclick="feedback(this, -1)">
                                    <img src="{{ url_for('static', filename='frown.svg') }}" alt="No"/>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                {% if topics_analyzed %}
                <div class="card mt-3">
                    <div class="card-title" id="network">
                        <h1 class="card-header">Network</h1>
                    </div>
                    <div class="card-body">
                        <p>
                            Explore citations between the papers of interest on the citations graph.
                        </p>
                        <button id="show_citations_graph" type="button" class="btn btn-light"
                                onclick="(function(){ graph_callback('citations') })();">
                            Show citations graph
                        </button>
                        <hr>
                        <p>
                            Similarity between papers is computed based on <em>bibliographic coupling</em>,
                            <em>co-citations</em>,<br>
                            <em>direct citations</em>, and <em>potential</em> citations based on text similarity.
                            <br>
                            Explore papers network, where similar papers are located together and connected.
                        </p>
                        <button id="show_structure_graph" type="button" class="col-auto btn btn-light"
                                onclick="(function(){ graph_callback('structure') })();">
                            Show structure graph
                        </button>
                        <div class="mt-3">
                            <small class="text-muted">Was this useful?</small>
                            <div id="feedback-network" class="btn-group-horizontal">
                                <button type="button" class="btn btn-sm btn-feedback-yes"
                                        onclick="feedback(this, 1)">
                                    <img src="{{ url_for('static', filename='smile.svg') }}" alt="Yes"/>
                                </button>
                                <button type="button" class="btn btn-sm btn-feedback-meh"
                                        onclick="feedback(this, 0)">
                                    <img src="{{ url_for('static', filename='meh.svg') }}" alt="Not sure"/>
                                </button>
                                <button type="button" class="btn btn-sm btn-feedback-no"
                                        onclick="feedback(this, -1)">
                                    <img src="{{ url_for('static', filename='frown.svg') }}" alt="No"/>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card mt-3">
                    <div class="card-title" id="topics">
                        <h1 class="card-header">Topics</h1>
                    </div>
                    <div class="card-body">
                        <p>
                            Topic is a group of papers which share common ideas, describe common features, etc.
                            <br>
                            Topics are extracted based on similarity between papers.
                            <br>
                        </p>
                        <p>
                            Similarity between topics is an average similarity between the papers.
                        </p>
                        {% for script, div in components_similarity %}
                        {{ script|safe }}
                        {{ div|safe }}
                        {% endfor %}
                        <hr>
                        <p>
                            Topic sizes. <em>Note: small topics are merged to "Other".</em>
                        </p>
                        <div>
                            {% for script, div in component_ratio %}
                            {{ script|safe }}
                            {{ div|safe }}
                            {% endfor %}
                        </div>
                        <hr>
                        <p>
                            Topics are organized hierarchically.
                        </p>
                        {% for script, div in topics_hierarchy %}
                        {{ script|safe }}
                        {{ div|safe }}
                        {% endfor %}
                        <div class="mt-3">
                            <small class="text-muted">Was this useful?</small>
                            <div id="feedback-topics" class="btn-group-horizontal">
                                <button type="button" class="btn btn-sm btn-feedback-yes"
                                        onclick="feedback(this, 1)">
                                    <img src="{{ url_for('static', filename='smile.svg') }}" alt="Yes"/>
                                </button>
                                <button type="button" class="btn btn-sm btn-feedback-meh"
                                        onclick="feedback(this, 0)">
                                    <img src="{{ url_for('static', filename='meh.svg') }}" alt="Not sure"/>
                                </button>
                                <button type="button" class="btn btn-sm btn-feedback-no"
                                        onclick="feedback(this, -1)">
                                    <img src="{{ url_for('static', filename='frown.svg') }}" alt="No"/>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card mt-3">
                    <div class="card-title" id="trends">
                        <h1 class="card-header">Trends</h1>
                    </div>
                    <div class="card-body">
                        <h2 class="card-subtitle">Topics summary</h2>
                        <p>
                            Explore the evolution of trends - dynamics is shown for the timeline.<br>
                            Colors are the same as in the previous diagram.
                        </p>
                        <div>
                            {% for script, div in component_size_summary %}
                            {{ script|safe }}
                            {{ div|safe }}
                            {% endfor %}
                        </div>
                        <hr>
                        <p>Summary publication year for topics.</p>
                        <div>
                            {% for script, div in component_years_summary %}
                            {{ script|safe }}
                            {{ div|safe }}
                            {% endfor %}
                        </div>
                        <div class="mt-3">
                            <small class="text-muted">Was this useful?</small>
                            <div id="feedback-trends" class="btn-group-horizontal">
                                <button type="button" class="btn btn-sm btn-feedback-yes"
                                        onclick="feedback(this, 1)">
                                    <img src="{{ url_for('static', filename='smile.svg') }}" alt="Yes"/>
                                </button>
                                <button type="button" class="btn btn-sm btn-feedback-meh"
                                        onclick="feedback(this, 0)">
                                    <img src="{{ url_for('static', filename='meh.svg') }}" alt="Not sure"/>
                                </button>
                                <button type="button" class="btn btn-sm btn-feedback-no"
                                        onclick="feedback(this, -1)">
                                    <img src="{{ url_for('static', filename='frown.svg') }}" alt="No"/>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card mt-3">
                    <div class="card-title" id="publications">
                        <h1 class="card-header">Publications</h1>
                    </div>
                    <div class="card-body">
                        <p>
                            Learn more about topics - most cited papers over time are shown for each topic.<br>
                            Papers are sorted descending by citations number overall from bottom to top.<br>
                            Year reflects publication year of the original paper.
                        </p>
                        <div>
                            {% for (script, div), word_cloud, zoom_in_callback in
                            topics_info_and_word_cloud_and_callback %}
                            <div id="topic-div-{{ loop.index }}">
                                <hr>
                                <h2 id="topic-{{ loop.index }}" class="card-subtitle">
                                    Topic {{ loop.index }}
                                    {% if loop.index0 == comp_other %}
                                    - OTHER
                                    {% endif %}
                                    <button type="button" class="btn btn-light"
                                            onclick="(function(){ papers_callback_component({{ loop.index }}); })();">
                                        <img src="{{ url_for('static', filename='list.svg') }}" alt="+"/>&nbsp;Show as
                                        list
                                    </button>
                                    <button type="button" class="btn btn-light"
                                            onclick="(function(){ {{ zoom_in_callback|safe }} })();">
                                        <img src="{{ url_for('static', filename='zoom-in.svg') }}" alt="+"/>&nbsp;Zoom
                                        into
                                    </button>
                                </h2>
                                Number of papers: {{ component_sizes[loop.index - 1] }}
                                <div class="row">
                                    <div class="col-3 no-padding-right">
                                        <strong>Word cloud</strong>
                                        <br>
                                        <canvas id="topic_word_cloud_{{ loop.index }}" width="0" height="0"
                                                style="border:1px solid #eee;">
                                            Canvas is not supported in your browser.
                                        </canvas>
                                    </div>
                                    <div class="col-9 no-padding-left" id="topic_chart_{{ loop.index }}">
                                        {{ script|safe }}
                                        {{ div|safe }}
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        <hr>
                        <p>
                            Explore related papers by taking into account all the referencing and citing relationships
                            for papers of interest.<br>
                            <strong>WARNING</strong>: number of papers can increase exponentially, analysis can be slow!
                        </p>
                        <button type="button" class="btn btn-light"
                                onclick="(function(){ {{ papers_zoom_out_callback|safe }} })();">
                            <img src="{{ url_for('static', filename='zoom-out.svg') }}" alt="-"/>&nbsp;Zoom out to
                            related papers
                        </button>
                        <div class="mt-3">
                            <small class="text-muted">Was this useful?</small>
                            <div id="feedback-papers" class="btn-group-horizontal">
                                <button type="button" class="btn btn-sm btn-feedback-yes"
                                        onclick="feedback(this, 1)">
                                    <img src="{{ url_for('static', filename='smile.svg') }}" alt="Yes"/>
                                </button>
                                <button type="button" class="btn btn-sm btn-feedback-meh"
                                        onclick="feedback(this, 0)">
                                    <img src="{{ url_for('static', filename='meh.svg') }}" alt="Not sure"/>
                                </button>
                                <button type="button" class="btn btn-sm btn-feedback-no"
                                        onclick="feedback(this, -1)">
                                    <img src="{{ url_for('static', filename='frown.svg') }}" alt="No"/>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}

                <div class="card mt-3">
                    <div class="card-title" id="authors">
                        <h1 class="card-header">Authors</h1>
                    </div>
                    <div class="card-body">
                        <p>
                            List of authors with the largest number of papers for given search query.<br>
                            The colors of the circles in the topics column indicate top 3 most common topics among
                            these papers.<br>
                            The topic circles are arranged according to the number of papers, in descending order.
                        </p>
                        <table id="authors-table" class="table table-sm table-bordered table-striped">
                            <thead>
                            <tr>
                                <th scope="col">#</th>
                                <th scope="col">Author</th>
                                <th scope="col">Papers</th>
                                <th scope="col">Topics</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for row in author_statistics %}
                            <tr>
                                <th scope="row">{{ loop.index }}</th>
                                <td>{{ row[0] }}</td>
                                <td>
                                    <button type="button" class="btn btn-link link"
                                            onclick="(function(){ papers_callback_author('{{ row[0] }}');})();">
                                        {{ row[1] }}
                                    </button>
                                </td>
                                <td>{{ row[2]|safe }}</td>
                            </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                        <div class="mt-3">
                            <small class="text-muted">Was this useful?</small>
                            <div id="feedback-authors" class="btn-group-horizontal">
                                <button type="button" class="btn btn-sm btn-feedback-yes"
                                        onclick="feedback(this, 1)">
                                    <img src="{{ url_for('static', filename='smile.svg') }}" alt="Yes"/>
                                </button>
                                <button type="button" class="btn btn-sm btn-feedback-meh"
                                        onclick="feedback(this, 0)">
                                    <img src="{{ url_for('static', filename='meh.svg') }}" alt="Not sure"/>
                                </button>
                                <button type="button" class="btn btn-sm btn-feedback-no"
                                        onclick="feedback(this, -1)">
                                    <img src="{{ url_for('static', filename='frown.svg') }}" alt="No"/>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card mt-3">
                    <div class="card-title" id="journals">
                        <h1 class="card-header">Journals</h1>
                    </div>
                    <div class="card-body">
                        <p>
                            List of journals with the largest number of papers for given search query.<br>
                            The colors of the circles in the topics column indicate top 3 most common topics among
                            these papers.<br>
                            The topic circles are arranged according to the number of papers, in descending order.
                        </p>
                        <table id="journals-table" class="table table-sm table-bordered table-striped">
                            <thead>
                            <tr>
                                <th scope="col">#</th>
                                <th scope="col">Journal</th>
                                <th scope="col">Papers</th>
                                <th scope="col">Topics</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for row in journal_statistics %}
                            <tr>
                                <th scope="row">{{ loop.index }}</th>
                                <td>{{ row[0] }}</td>
                                <td>
                                    <button type="button" class="btn btn-link link" onclick="(function(){
                                papers_callback_journal('{{ row[0] }}');
                            })();">{{ row[1] }}
                                    </button>
                                </td>
                                <td>{{ row[2]|safe }}</td>
                            </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                        <div class="mt-3">
                            <small class="text-muted">Was this useful?</small>
                            <div id="feedback-journals" class="btn-group-horizontal">
                                <button type="button" class="btn btn-sm btn-feedback-yes"
                                        onclick="feedback(this, 1)">
                                    <img src="{{ url_for('static', filename='smile.svg') }}" alt="Yes"/>
                                </button>
                                <button type="button" class="btn btn-sm btn-feedback-meh"
                                        onclick="feedback(this, 0)">
                                    <img src="{{ url_for('static', filename='meh.svg') }}" alt="Not sure"/>
                                </button>
                                <button type="button" class="btn btn-sm btn-feedback-no"
                                        onclick="feedback(this, -1)">
                                    <img src="{{ url_for('static', filename='frown.svg') }}" alt="No"/>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card mt-3">
                    <div class="card-title" id="numbers">
                        <h1 class="card-header">Numbers</h1>
                    </div>
                    <div class="card-body">
                        <p>
                            Numbers are extracted from papers abstracts, use search to filter the table.
                        </p>
                        {% if numbers is defined %}
                        <table id="numbers-table" class="table table-sm table-bordered table-striped">
                            <thead>
                            <tr>
                                <th scope="col">#</th>
                                <th scope="col">Title</th>
                                <th scope="col">Numbers</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for id, url, title, metrics in numbers %}
                            <tr>
                                <th scope="row">{{ loop.index }}</th>
                                <td><a class="link" href="{{ url }}">{{ title }}</a></td>
                                <td>{{ metrics }}</td>
                            </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                        {% endif %}
                        <div class="mt-3">
                            <small class="text-muted">Was this useful?</small>
                            <div id="feedback-numbers" class="btn-group-horizontal">
                                <button type="button" class="btn btn-sm btn-feedback-yes"
                                        onclick="feedback(this, 1)">
                                    <img src="{{ url_for('static', filename='smile.svg') }}" alt="Yes"/>
                                </button>
                                <button type="button" class="btn btn-sm btn-feedback-meh"
                                        onclick="feedback(this, 0)">
                                    <img src="{{ url_for('static', filename='meh.svg') }}" alt="Not sure"/>
                                </button>
                                <button type="button" class="btn btn-sm btn-feedback-no"
                                        onclick="feedback(this, -1)">
                                    <img src="{{ url_for('static', filename='frown.svg') }}" alt="No"/>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card mt-3">
                    <div class="card-title" id="evolution">
                        <h1 class="card-header">Topic Evolution</h1>
                    </div>
                    <div class="card-body">
                        <p>
                            Topics extraction is performed longitudinally at several time points to detect merges and splits
                            of topics. <br>
                            Edge width reflects the number of papers which moved from one topic to another.<br>
                            <i>NPY</i> - not published yet.
                        </p>
                        {% if topic_evolution is defined %}
                        {% for script, div in topic_evolution %}
                        {{ script|safe }}
                        {{ div|safe }}
                        {% endfor %}
                        {% if topic_evolution_keywords is defined %}
                        <table id="topic_evolution_keywords" class="table table-sm table-bordered table-striped">
                            <thead>
                            <tr>
                                <th scope="col">#</th>
                                <th scope="col">Year</th>
                                <th scope="col">Topic</th>
                                <th scope="col">Tags</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for year, topic, kwds in topic_evolution_keywords %}
                            <tr>
                                <th scope="row">{{ loop.index }}</th>
                                <td>{{ year }}</td>
                                <td>{{ topic }}</td>
                                <td>{{ kwds }}</td>
                            </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                        {% endif %}
                        <div class="mt-3">
                            <small class="text-muted">Was this useful?</small>
                            <div id="feedback-evolution" class="btn-group-horizontal">
                                <button type="button" class="btn btn-sm btn-feedback-yes"
                                        onclick="feedback(this, 1)">
                                    <img src="{{ url_for('static', filename='smile.svg') }}" alt="Yes"/>
                                </button>
                                <button type="button" class="btn btn-sm btn-feedback-meh"
                                        onclick="feedback(this, 0)">
                                    <img src="{{ url_for('static', filename='meh.svg') }}" alt="Not sure"/>
                                </button>
                                <button type="button" class="btn btn-sm btn-feedback-no"
                                        onclick="feedback(this, -1)">
                                    <img src="{{ url_for('static', filename='frown.svg') }}" alt="No"/>
                                </button>
                            </div>
                        </div>
                        {% else %}
                        Failed to analyze topic evolution because year step is too big.
                        {% endif %}
                    </div>
                </div>

                <div class="card mt-3">
                    <div class="card-title" id="review">
                        <h1 class="card-header">Review</h1>
                    </div>
                    <div class="card-body">
                        <p>
                            Generate a review for the chosen topic.<br>
                        </p>
                        <div class="row no-gutters align-items-center mb-3">
                            <div class="col input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="number-papers-addon">Number of papers</span>
                                </div>
                                <input class="form-control form-control-borderless" type="number"
                                       name="number-papers" id="papers-input"
                                       value="10"
                                       aria-describedby="number-papers-addon"
                                       autofocus required>
                            </div>
                            <div class="col input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="number-of-sents-addon">Sentences each</span>
                                </div>
                                <input class="form-control form-control-borderless" type="number"
                                       name="number-of-sents" id="sents-input"
                                       value="1"
                                       aria-describedby="number-of-sents-addon"
                                       autofocus required>
                            </div>
                        </div>
                        <button type="button" class="btn btn-primary" onclick="(function(){
                                review_callback(document.getElementById('papers-input').value,document.getElementById('sents-input').value);
                            })();">Generate review</button>
                        <div class="mt-3">
                            <small class="text-muted">Was this useful?</small>
                            <div id="feedback-review" class="btn-group-horizontal">
                                <button type="button" class="btn btn-sm btn-feedback-yes"
                                        onclick="feedback(this, 1)">
                                    <img src="{{ url_for('static', filename='smile.svg') }}" alt="Yes"/>
                                </button>
                                <button type="button" class="btn btn-sm btn-feedback-meh"
                                        onclick="feedback(this, 0)">
                                    <img src="{{ url_for('static', filename='meh.svg') }}" alt="Not sure"/>
                                </button>
                                <button type="button" class="btn btn-sm btn-feedback-no"
                                        onclick="feedback(this, -1)">
                                    <img src="{{ url_for('static', filename='frown.svg') }}" alt="No"/>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card mt-3">
                    <div class="card-title" id="feedback">
                        <h1 class="card-header">We value your opinion</h1>
                    </div>
                    <div class="card-body">
                        <p>
                            Please help us to make the service better!<br>
                            Use the form below to tell us more about you and your opinion about the service,<br>
                            or click instant feedback buttons to share your feelings about particular report section.<br>
                            Also you can optionally leave your email to contact you later.
                        </p>
                        <form name="feedback-form" action="feedback" method="POST">
                            <div class="form-group">
                                <label for="feedback-message">Message</label>
                                <textarea class="form-control" id="feedback-message" name="message"
                                          rows="5" maxlength="2000"
                                          aria-describedby="emailHelp"
                                          placeholder="Enter message"></textarea>
                                <small id="messageHelp" class="form-text text-muted">
                                    Max length: 2000.</small>
                            </div>
                            <div class="form-group">
                                <label for="feedback-email">Email address</label>
                                <input type="email" class="form-control" id="feedback-email" name="email"
                                       aria-describedby="emailHelp"
                                       placeholder="Enter email"/>
                                <small id="emailHelp" class="form-text text-muted">
                                    We'll never share your email with anyone else.</small>
                            </div>
                            <div class="form-group">
                                <button type="submit" class="btn btn-primary">Submit</button>
                            </div>
                            <div class="form-group">
                                <input type="hidden" class="form-control" id="feedback-jobid" name="jobid" value=""/>
                                <input type="hidden" class="form-control" name="type" value="result"/>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="mt-3 ml-3" id="log">
                    <h5><a class="link" data-toggle="collapse" href="#collapseLog"
                           role="button" aria-expanded="false"
                           aria-controls="collapseCocitations">
                        Logs
                    </a></h5>
                    <div id="collapseLog" class="card-body collapse">
                        <pre>{{log}}</pre>
                    </div>
                </div>
            </div>
        </main>

        <!--Right alignment-->
        <div class="d-none d-xl-block col-xl-2"></div>
    </div>
</div>
<footer>
    <p>version {{ version }}<br/>
        &copy; 2019-2020 <a href="https://research.jetbrains.org/groups/biolabs"
                            title="JetBrains Research BioLabs"
                            target="_blank">JetBrains Research</a></p>
</footer>
<script type="text/javascript">
    function startIntro(){
        var intro = introJs();
        intro.setOptions({
            steps: [
                {
                    intro: "This page is a report of the analysis for the query <em>{{query}} at {{source}}<br>{{limit}} {{sort}}</em>."
                },
                {
                    element: '#sidebar',
                    intro: "Results are organised into sections - different aspects of analysis."
                },
                {
                    element: '#overview',
                    intro: "The report starts with a general information about the topic of interest. " +
                        "It shows total number of papers, citations, and general information like overall " +
                        "publications dynamics, and most common words in the field."
                },
                {
                    element: '#n_papers',
                    intro: '{{n_papers}} papers were found and analyzed.'
                },
                {
                    element: '#n_citations',
                    intro: '{{n_citations}} is the summary number of all the citations of the papers.'
                },
                {
                    element: '#n_topics',
                    intro: "{{n_topics}} topics were found among the papers.<br>"
                },
                {
                    element: '#papers_word_cloud',
                    intro: "Click on any keyword to open the list of papers with this keyword in a new tab."
                },
                {
                    element: '#show_as_list',
                    intro: "Click <img src=\"{{ url_for('static', filename='list.svg') }}\" alt=\"+\"/> " +
                        "<em>Show as list</em> anytime to open the list of papers in a separate window."
                },
                {
                    element: '#highlights',
                    intro: "Highlights section contains information about most notable papers. " +
                        "Top cited papers, papers of the year, and hot papers are shown in a dedicated sections."
                },
                {
                    element: '#show_citations_graph',
                    intro: "Click <em>Show citations graph</em> to explore citations graph among the papers."
                },
                {
                    element: '#show_structure_graph',
                    intro: "Click <em>Show structure graph</em> to explore overall papers similarity."
                },
                {
                    element: '#topics',
                    intro: "Topic is a group of papers which share common ideas, describe common features, etc.<br>" +
                        "Topics are extracted based on citations graph and text analysis."
                },
                {
                    element: '#topic-1',
                    intro: "This is the detailed information about topic 1. As usual, " +
                        "click <img src=\"{{ url_for('static', filename='list.svg') }}\" alt=\"+\"/> " +
                        "<em>Show as list</em> to open the list of papers for the topic or " +
                        "use the <img src=\"{{ url_for('static', filename='zoom-in.svg') }}\" alt=\"+\"/> " +
                        "<em>Zoom into</em> button to run analysis for this particular topic.<br>"
                },
                {
                    element: '#topic_chart_1',
                    intro: "Hover over glyphs to check out tooltips that contain general information " +
                        "about the papers. Click glyphs to open a page about corresponding paper in a " +
                        "new tab."
                },
                {
                    element: '#authors',
                    intro: "Information about authors and journals with the largest number of papers " +
                        "is organised into tables, which also show distribution over topics. You can " +
                        "open all papers for a certain author or journal by clicking the corresponding " +
                        "number of papers."
                },
                {
                    element: '#numbers',
                    intro: "Explore numbers hidden in papers abstracts!"
                },
                {
                    element: '#evolution',
                    intro: "Explore evolution of ideas in the field."
                },
                {   intro: "Congratulations!<br>" +
                        "Now you are ready to explore scientific literature with PubTrends."
                }
            ]
        });

        intro.start();
    }
</script>
</body>
</html>