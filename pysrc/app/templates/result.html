<!DOCTYPE html>
<head>
    <title>{{ query }} at {{ source }}{{ search_string }} {{ limit }} {{ sort }} - PubTrends</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet"
          href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
          crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css"
          integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt"
          crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"
            integrity="sha384-tsQFqpEReu7ZLhBV2VZlAu7zcOV+rXbYlF2cqB8txI/8aZajjp4Bqd+V6D5IgvKT"
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
            integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
            crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
            integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
            crossorigin="anonymous"></script>
    <script src="https://cdn.bokeh.org/bokeh/release/bokeh-3.1.1.min.js"
            crossorigin="anonymous"></script>
    <script src="https://cdn.bokeh.org/bokeh/release/bokeh-widgets-3.1.1.min.js"
            crossorigin="anonymous"></script>

    <!-- DataTables with search -->
    <script src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.21/js/dataTables.bootstrap4.min.js"></script>
    <link href="https://cdn.datatables.net/1.10.21/css/dataTables.bootstrap4.min.css"
          rel="stylesheet" type="text/css">
    <!-- DataTables search highlight -->
    <script src="https://cdn.jsdelivr.net/g/mark.js(jquery.mark.min.js)"></script>
    <script src="https://cdn.datatables.net/plug-ins/1.10.13/features/mark.js/datatables.mark.js"></script>
    <link href="https://cdn.datatables.net/plug-ins/1.10.13/features/mark.js/datatables.mark.min.css"
          type="text/css">


    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}?v=1"/>
    <!--     <link rel="stylesheet" href="../static/style.css"/> -->
    <link rel="stylesheet" href="{{ url_for('static', filename='result.css') }}?v=1">
    <!--    <link rel="stylesheet" href="../static/result.css"/>-->
    <script src="{{ url_for('static', filename='wordcloud.js') }}"></script>
    <!--    <script src="../static/wordcloud.js"/>-->
    <script src="{{ url_for('static', filename='text_utils.js') }}"></script>
    <!--    <script src="../static/text_utils.js"/>-->

    <!-- Feedback -->
    <script src="{{ url_for('static', filename='feedback.js') }}"></script>
    <!--    <script src="../static/feedback.js"/>-->
    <link rel="stylesheet" href="{{ url_for('static', filename='feedback.css') }}?v=1">
    <!--    <link rel="stylesheet" href="../static/feedback.css"/>-->

    <script>
        "use strict";

        function papers_callback_impl(key, value) {
            const url = '/papers?query=' + normalize('{{ query }}') + '&source={{source}}&limit={{limit}}&sort={{sort}}';
            // Decode jobid from URL
            const jobid = new URL(window.location).searchParams.get('jobid');
            let args = '';
            if (key != null) {
                args = '&' + key + '=' + value;
            }
            window.open(url + args + '&jobid=' + jobid, '_blank');
        }

        function papers_callback() {
            papers_callback_impl(null, null)
        }

        function papers_callback_component(comp) {
            papers_callback_impl('comp', comp)
        }

        function papers_callback_word(word) {
            papers_callback_impl('word', word)
        }

        function papers_callback_author(author) {
            papers_callback_impl('author', author)
        }

        function papers_callback_journal(journal) {
            papers_callback_impl('journal', journal)
        }

        function papers_callback_top_papers() {
            papers_callback_impl('papers_list', 'top')
        }

        function papers_callback_papers_of_the_year() {
            papers_callback_impl('papers_list', 'year')
        }

        function papers_callback_hot_papers() {
            papers_callback_impl('papers_list', 'hot')
        }

        function graph_callback() {
            const url = '/graph?query=' + normalize('{{ query }}') + '&source={{source}}&limit={{limit}}&sort={{sort}}';
            // Decode jobid from URL
            const jobid = new URL(window.location).searchParams.get('jobid');
            window.open(url + '&jobid=' + jobid, '_blank');
        }

        function export_data() {
            const url = '/export_data?query=' + normalize('{{ query }}') + '&source={{source}}&limit={{limit}}&sort={{sort}}';
            // Decode jobid from URL
            const jobid = new URL(window.location).searchParams.get('jobid');
            window.open(url + '&jobid=' + jobid, '_blank');
        }

        function review_callback(papersNumber, sentsNumber) {
            const url = '/generate_review?query=' + normalize('{{ query }}') + '&source={{source}}&limit={{limit}}&sort={{sort}}';
            // Decode jobid from URL
            const jobid = new URL(window.location).searchParams.get('jobid');
            window.open(url + '&jobid=' + jobid + '&papers_number=' + papersNumber + '&sents_number=' + sentsNumber, '_blank');
        }

        $(document).ready(function () {
            // Mark search by default in datatables
            $.extend(true, $.fn.dataTable.defaults, {
                mark: true
            });

            // Disable formatter for the next section because of injections.
            // Enable formatter control in File > Settings > Editor > Code Style
            // @formatter:off

            // Setup datatables
            $('#authors-table').DataTable();
            $('#journals-table').DataTable();
            {% if topic_evolution is defined %}
            $('#topic_evolution_keywords').DataTable();
            {% endif %}

            // Enable search for numbers only in numbers table
            {% if numbers is defined %}
            // disable search on the first column
            $('#numbers-table').DataTable({
                "columnDefs": [
                    {"searchable": false, "targets": 1}
                ]
            });
            {% endif %}

            // Process main word cloud
            let word_records = JSON.parse(normalize('{{ papers_word_cloud }}'));
            process_word_cloud('papers_word_cloud', $('#papers_word_cloud').outerWidth(),
                335, 200, 300, word_records, papers_callback_word);

            // Process topics word clouds
            let cid = '';
            {% for (script, div), word_cloud, is_empty in topics_info_and_word_cloud %}
            word_records = JSON.parse(normalize('{{ word_cloud }}'));
            // Ignore artificial tags for scale
            // word record [word, x, y, size, vertical, color]
            word_records = word_records.filter(wr => !wr[0].startsWith("#"));
            cid = 'topic_word_cloud_{{ loop.index }}';
            if ({{ is_empty }})
            {
                process_word_cloud(cid, $('#' + cid).outerWidth(), 335, 200, 300, word_records, null);
            }
            else
            {
                process_word_cloud(cid, $('#' + cid).outerWidth(), 335, 200, 300, word_records, papers_callback_word);
            }
            {% endfor %}

            // @formatter:on

            // Configure jobid for feedback for text message form, decode jobid from URL
            const jobid = new URL(window.location).searchParams.get('jobid');
            $('#feedback-jobid').val(jobid);

            // Create clickable feedback forms
            createClickableFeedBackForm("feedback-papers-form", "feedback-papers");
            createClickableFeedBackForm("feedback-trends-form", "feedback-trends");
            createClickableFeedBackForm("feedback-network-form", "feedback-network");
            createClickableFeedBackForm("feedback-topics-form", "feedback-topics");
            createClickableFeedBackForm("feedback-authors-form", "feedback-authors");
            createClickableFeedBackForm("feedback-journals-form", "feedback-journals");
            createClickableFeedBackForm("feedback-numbers-form", "feedback-numbers");
            createClickableFeedBackForm("feedback-evolution-form", "feedback-evolution");
            createClickableFeedBackForm("feedback-review-form", "feedback-review");
        });
    </script>
</head>
<body>

<!-- Fixed navbar -->
<nav class="navbar navbar-light bg-light fixed-top border-bottom no-padding-right">
    <div class="row container-fluid no-padding-right">
        <div class="col-lg-1 col-xl-2 no-padding-left">
            <a id="pubtrends" class="navbar-brand" href="/">PubTrends</a>
        </div>
        <div class="col-lg-11 col-xl-8 no-padding-left no-padding-right">
            <div class="no-padding-left d-flex justify-content-between">
                <ol class="breadcrumb bg-light search-query">
                    <li class="breadcrumb-item vertical-center">{{ source }}</li>
                    <li class="breadcrumb-item vertical-center"><strong>{{ query }}</strong></li>
                    <li class="breadcrumb-item vertical-center">{{ limit }} {{ sort }}</li>
                </ol>
                <a id="tour-start1" class="btn btn-secondary float-right d-xl-none"
                   href="javascript:void(0);" onclick="startIntro();">?</a>
            </div>
        </div>
    </div>
</nav>

<div class="container-fluid">
    <div class="row ">
        <!-- Sticky sidebar -->
        <nav class="d-none d-xl-block d-lg-block col-lg-1 col-xl-2 sidebar no-padding">
            <div class="sidebar-sticky" id="sidebar">
                <ul class="nav flex-column">
                    <li class="nav-item row">
                        <a class="nav-link no-padding-right" href="#papers" title="Papers">
                            <img class="nav-icon" src="{{ url_for('static', filename='home.svg') }}"/>
                        </a>
                        <a class="nav-link d-none d-xl-block no-padding" href="#papers">
                            Papers
                        </a>
                    </li>

                    {% if topics_analyzed %}
                        <li class="nav-item row">
                            <a class="nav-link no-padding-right" href="#trends" title="Trends">
                                <img class="nav-icon" src="{{ url_for('static', filename='bar-chart-2.svg') }}"/>
                            </a>
                            <a class="nav-link d-none d-xl-block no-padding" href="#trends">
                                Trends
                            </a>
                        </li>
                        <li class="nav-item row">
                            <a class="nav-link no-padding-right" href="#network" title="Network">
                                <img class="nav-icon" src="{{ url_for('static', filename='globe.svg') }}"/>
                            </a>
                            <a class="nav-link d-none d-xl-block no-padding" href="#network">
                                Network
                            </a>
                        </li>
                        <li class="nav-item row">
                            <a class="nav-link no-padding-right" href="#topics" title="Topics">
                                <img class="nav-icon" src="{{ url_for('static', filename='tag.svg') }}"/>
                            </a>
                            <a class="nav-link d-none d-xl-block no-padding" href="#topics">
                                Topics
                            </a>
                        </li>
                    {% endif %}

                    {% if feature_authors_enabled %}
                        <li class="nav-item row">
                            <a class="nav-link no-padding-right" href="#authors" title="Authors">
                                <img src="{{ url_for('static', filename='users.svg') }}"/>
                            </a>
                            <a class="nav-link d-none d-xl-block no-padding" href="#authors">
                                Authors
                            </a>
                        </li>
                    {% endif %}

                    {% if feature_journals_enabled %}
                        <li class="nav-item row">
                            <a class="nav-link no-padding-right" href="#journals" title="Journals">
                                <img class="nav-icon" src="{{ url_for('static', filename='book-open.svg') }}"/>
                            </a>
                            <a class="nav-link d-none d-xl-block no-padding" href="#journals">
                                Journals
                            </a>
                        </li>
                    {% endif %}

                    {% if feature_numbers_enabled %}
                        <li class="nav-item row">
                            <a class="nav-link no-padding-right" href="#numbers" title="Numbers">
                                <img src="{{ url_for('static', filename='hash.svg') }}"/>
                            </a>
                            <a class="nav-link d-none d-xl-block no-padding" href="#numbers">
                                Numbers
                            </a>
                        </li>
                    {% endif %}

                    {% if feature_evolution_enabled %}
                        <li class="nav-item row">
                            <a class="nav-link no-padding-right" href="#evolution" title="Evolution">
                                <img src="{{ url_for('static', filename='compass.svg') }}"/>
                            </a>
                            <a class="nav-link d-none d-xl-block no-padding" href="#evolution">
                                Evolution
                            </a>
                        </li>
                    {% endif %}

                    {% if feature_review_enabled %}
                        <li class="nav-item row">
                            <a class="nav-link no-padding-right" href="#review" title="Review">
                                <img class="nav-icon" src="{{ url_for('static', filename='list.svg') }}"/>
                            </a>
                            <a class="nav-link d-none d-xl-block no-padding" href="#review">
                                Review
                            </a>
                        </li>
                    {% endif %}

                </ul>
            </div>
        </nav>

        <!-- Main content -->
        <main class="col-lg-11 col-xl-8" role="main">
            <div class="card mt-3" autofocus>
                <div class="card-title" id="papers">
                    <h2 class="card-header">Papers</h2>
                </div>
                <div class="card-body">
                    <p>
                        Analyzed <strong>{{ n_papers }}</strong> papers and <strong>{{ n_topics }}</strong> topics.
                    </p>
                    <button id="papers-list" type="button" class="btn btn-light"
                            onclick="papers_callback();">
                        <img src="{{ url_for('static', filename='list.svg') }}" alt="+"/>&nbsp;Show all papers
                    </button>
                    <div class="row mt-2">
                        <div class="col-3 no-padding-right" style="min-width: 185px;">
                            <small><strong>Frequent words</strong></small>
                            <br>
                            <canvas id="papers_word_cloud" style="border:1px solid #eee; width: 100%; height: 100%;">
                                Canvas is not supported in your browser.
                            </canvas>
                        </div>
                        <div class="col-9 no-padding-left">
                            <small><strong>&nbsp;&nbsp;&nbsp;Papers per year</strong></small>
                            <br>
                            {% for script, div in papers_stats %}
                                {{ script|safe }}
                                {{ div|safe }}
                            {% endfor %}
                        </div>
                    </div>
                    <div id="search-in-papers" class="row">
                        <div class="col col-auto">
                            <input id="search-input" type="text" class="form-control"
                                   placeholder="Search in papers...">
                        </div>
                        <div class="col col-auto no-padding-left">
                            <button id="search_word" type="button" class="btn btn-light"
                                    onclick="papers_callback_word($('#search-input').val().trim());">
                                <img src="{{ url_for('static', filename='search.svg') }}" alt=""/>&nbsp;Search
                            </button>
                        </div>
                    </div>
                    <div class="mt-3" id="feedback-papers-form"></div>
                </div>
            </div>

            <div class="card mt-3">
                <div class="card-title" id="trends">
                    <h1 class="card-header">Trends</h1>
                </div>
                <div class="card-body">
                    <strong>Top Cited Papers</strong>
                    <p>
                        Top 50 cited papers are shown among all the papers for given search query.<br>
                        Year reflects publication year of the original paper.
                    </p>
                    <button type="button" class="btn btn-light"
                            onclick="papers_callback_top_papers();">
                        <img src="{{ url_for('static', filename='list.svg') }}" alt="+"/>&nbsp;Show as list
                    </button>
                    <div>
                        {% for script, div in top_cited_papers %}
                            {{ script|safe }}
                            {{ div|safe }}
                        {% endfor %}
                    </div>
                    <hr>

                    <strong>Top Cited Papers of the Year</strong>
                    <p>
                        For each year we show the paper which has the most significant number of citations in a
                        given year.<br>
                        Different papers have different colors.
                    </p>
                    <button type="button" class="btn btn-light"
                            onclick="papers_callback_papers_of_the_year();">
                        <img src="{{ url_for('static', filename='list.svg') }}" alt="+"/>&nbsp;Show as list
                    </button>
                    <div>
                        {% for script, div in most_cited_per_year_papers %}
                            {{ script|safe }}
                            {{ div|safe }}
                        {% endfor %}
                    </div>
                    <hr>

                    <strong>Hot Papers</strong>
                    <p>
                        For each year we show a recent paper which has the biggest growth in citations.<br>
                        Growth is computed as a fraction of citations count in particular year to the count in
                        previous year.<br>
                        Different papers have different colors.
                    </p>
                    <button type="button" class="btn btn-light"
                            onclick="papers_callback_hot_papers();">
                        Show as list
                    </button>
                    <div>
                        {% for script, div in fastest_growth_per_year_papers %}
                            {{ script|safe }}
                            {{ div|safe }}
                        {% endfor %}
                    </div>

                    <hr>
                    <strong>Keyword frequencies</strong>
                    <p>
                        For each year we show a number of papers containing most frequent keywords.<br>
                        <i>NOTE</i>: the plot is slightly smoothed.
                    </p>
                    <div>
                        {% for script, div in keywords_frequencies %}
                            {{ script|safe }}
                            {{ div|safe }}
                        {% endfor %}
                    </div>

                    <div class="mt-3" id="feedback-trends-form"></div>
                </div>
            </div>

            <div class="card mt-3">
                <div class="card-title" id="network">
                    <h1 class="card-header">Network</h1>
                </div>
                <div class="card-body">
                    {% if n_papers <= max_graph_size %}
                        {% if papers_graph is defined %}
                            <strong>Papers similarity</strong>
                            <p>
                                The graph below shows papers similarity network. Similar papers are located closely.<br>
                                Edges represent co-citations, common references and citations between papers.<br>
                                Color represents topic, size - total citations number.
                            </p>
                            {% for script, div in papers_graph %}
                                {{ script|safe }}
                                {{ div|safe }}
                            {% endfor %}
                        {% endif %}
                        <br>
                        <p>
                            Explore papers similarity in-depth in the interactive graph viewer.<br>
                            Filter papers by keywords and apply different coloring schemes.
                        </p>
                        <button type="button" class="btn btn-light" onclick="graph_callback();">
                            Explore
                        </button>
                    {% else %}
                        Too many papers to visualize papers graph.
                    {% endif %}
                    <div class="mt-3" id="feedback-network-form"></div>
                </div>
            </div>

            <div class="card mt-3">
                <div class="card-title" id="topics">
                    <h1 class="card-header">Topics</h1>
                </div>
                <div class="card-body">
                    {% if topics_analyzed %}
                        <strong>Topics summary</strong>
                        <p>
                            Topic is a group of similar papers which share common ideas, describe common features, etc.
                            <br>
                            Topics are extracted based on similarity between papers based on <em>common references</em>,
                            <em>co-citations</em>, <em>direct citations</em>, and text similarity.<br>
                            Information about topics - keywords, sizes, publication years are shown below.<br>
                        </p>
                        {% for script, div in topic_years_distribution %}
                            {{ script|safe }}
                            {{ div|safe }}
                        {% endfor %}

                        {% if topics_hierarchy_with_keywords is defined %}
                            <hr>
                            <strong>Topics hierarchy</strong>
                            <p>
                                Topics are organized hierarchically. Clustering dendrogram with keywords is shown below.
                            </p>
                            {% for script, div in topics_hierarchy_with_keywords %}
                                {{ script|safe }}
                                {{ div|safe }}
                            {% endfor %}
                        {% endif %}
                        <hr>
                        <strong>Topics papers</strong>
                        <p>
                            Papers for topics are sorted descending by citations number overall from bottom to top.<br>
                            Word clouds show keywords specific for topics.
                        </p>
                        <div>
                            {% for (script, div), word_cloud, is_empty in topics_info_and_word_cloud %}
                                <div id="topic-div-{{ loop.index }}">

                                    <div style="display: inline">
                                        <strong id="topic-{{ loop.index }}">
                                            Topic {{ loop.index }}
                                        </strong>
                                        <button type="button" class="btn btn-light"
                                                onclick="papers_callback_component({{ loop.index }});">
                                            <img src="{{ url_for('static', filename='list.svg') }}" alt="+"/>&nbsp;Show
                                            as
                                            list
                                        </button>
                                    </div>
                                    Number of papers: {{ component_sizes[loop.index - 1] }}
                                    <div class="row">
                                        <div class="col-3 no-padding-right" style="min-width: 185px;">
                                            <small><strong>Topic words</strong></small>
                                            <br>
                                            <canvas id="topic_word_cloud_{{ loop.index }}"
                                                    style="border:1px solid #eee; width: 100%; height: 100%;">
                                                Canvas is not supported in your browser.
                                            </canvas>
                                        </div>
                                        <div class="col-9 no-padding-left" id="topic_chart_{{ loop.index }}">
                                            <small><strong>&nbsp;&nbsp;&nbsp;Publications</strong></small>
                                            {{ script|safe }}
                                            {{ div|safe }}
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}
                    <div class="mt-3" id="feedback-topics-form"></div>
                </div>
            </div>

            {% if feature_authors_enabled %}
                <div class="card mt-3">
                    <div class="card-title" id="authors">
                        <h1 class="card-header">Authors</h1>
                    </div>
                    <div class="card-body">
                        <strong>Authors papers and topics</strong>
                        <p>
                            List of authors with the largest number of papers for given search query.<br>
                            The colors of the circles in the topics column indicate top 3 most common topics among
                            these papers.
                        </p>
                        <table id="authors-table" class="table table-sm table-bordered table-striped">
                            <thead>
                            <tr>
                                <th scope="col">#</th>
                                <th scope="col">Author</th>
                                <th scope="col">Papers</th>
                                <th scope="col">Topics</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for row in author_statistics %}
                                <tr>
                                    <th scope="row">{{ loop.index }}</th>
                                    <td>{{ row[0] }}</td>
                                    <td>
                                        <button type="button" class="btn btn-link link"
                                                onclick="papers_callback_author('{{ row[0] }}');">
                                            {{ row[1] }}
                                        </button>
                                    </td>
                                    <td>{{ row[2]|safe }}</td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                        <div class="mt-3" id="feedback-authors-form"></div>
                    </div>
                </div>
            {% endif %}

            {% if feature_journals_enabled %}
                <div class="card mt-3">
                    <div class="card-title" id="journals">
                        <h1 class="card-header">Journals</h1>
                    </div>
                    <div class="card-body">
                        <strong>Journals topics</strong>
                        <p>
                            List of journals with the largest number of papers for given search query.<br>
                            The colors of the circles in the topics column indicate top 3 most common topics among
                            these papers.
                        </p>
                        <table id="journals-table" class="table table-sm table-bordered table-striped">
                            <thead>
                            <tr>
                                <th scope="col">#</th>
                                <th scope="col">Journal</th>
                                <th scope="col">Papers</th>
                                <th scope="col">Topics</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for row in journal_statistics %}
                                <tr>
                                    <th scope="row">{{ loop.index }}</th>
                                    <td>{{ row[0] }}</td>
                                    <td>
                                        <button type="button" class="btn btn-link link"
                                                onclick="papers_callback_journal('{{ row[0] }}');">{{ row[1] }}
                                        </button>
                                    </td>
                                    <td>{{ row[2]|safe }}</td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                        <div class="mt-3" id="feedback-journals-form"></div>
                    </div>
                </div>
            {% endif %}

            {% if feature_numbers_enabled %}
                <div class="card mt-3">
                    <div class="card-title" id="numbers">
                        <h1 class="card-header">Numbers</h1>
                    </div>
                    <div class="card-body">
                        <strong>Numbers and features</strong>
                        <p>
                            Quantitative features extracted from papers titles and abstracts, use search to filter the
                            table.
                        </p>
                        {% if numbers is defined %}
                            <table id="numbers-table" class="table table-sm table-bordered table-striped">
                                <thead>
                                <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">Title</th>
                                    <th scope="col">Numbers</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for id, url, title, metrics in numbers %}
                                    <tr>
                                        <th scope="row">{{ loop.index }}</th>
                                        <td><a class="link" href="{{ url }}">{{ title }}</a></td>
                                        <td>{{ metrics }}</td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        {% endif %}
                        <div class="mt-3" id="feedback-numbers-form"></div>
                    </div>
                </div>
            {% endif %}

            {% if feature_evolution_enabled %}
                <div class="card mt-3">
                    <div class="card-title" id="evolution">
                        <h1 class="card-header">Topic Evolution</h1>
                    </div>
                    <div class="card-body">
                        <strong>Topics over time</strong>
                        <p>
                            Topics extraction is performed longitudinally at several time points to detect merges and
                            splits of topics. <br>
                            Edge width reflects the number of papers which moved from one topic to another.<br>
                            <i>NPY</i> - not published yet.
                        </p>
                        {% if topic_evolution is defined %}
                            {% for script, div in topic_evolution %}
                                {{ script|safe }}
                                {{ div|safe }}
                            {% endfor %}
                            <table id="topic_evolution_keywords" class="table table-sm table-bordered table-striped">
                                <thead>
                                <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">Year</th>
                                    <th scope="col">Topic</th>
                                    <th scope="col">Tags</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for year, topic, kwds in topic_evolution_keywords %}
                                    <tr>
                                        <th scope="row">{{ loop.index }}</th>
                                        <td>{{ year }}</td>
                                        <td>{{ topic }}</td>
                                        <td>{{ kwds }}</td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                            <div class="mt-3" id="feedback-evolution-form"></div>
                        {% else %}
                            Topics evolution is not available.
                        {% endif %}
                    </div>
                </div>
            {% endif %}

            {% if feature_review_enabled %}
                <div class="card mt-3">
                    <div class="card-title" id="review">
                        <h1 class="card-header">Review</h1>
                    </div>
                    <div class="card-body">
                        <strong>Extractive summarization review</strong>
                        <p>
                            Generate a review for the chosen topic - a set of sentences from top cited papers <br>
                            with the highest probability to be included in a real review paper.
                        </p>
                        <div class="row no-gutters align-items-center mb-3">
                            <div class="col input-group mr-2">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="number-papers-addon">Number of papers</span>
                                </div>
                                <input class="form-control form-control-borderless" type="number"
                                       name="number-papers" id="papers-input"
                                       value="10"
                                       aria-describedby="number-papers-addon"
                                       required>
                            </div>
                            <div class="col input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="number-of-sents-addon">Sentences each</span>
                                </div>
                                <input class="form-control form-control-borderless" type="number"
                                       name="number-of-sents" id="sents-input"
                                       value="1"
                                       aria-describedby="number-of-sents-addon"
                                       required>
                            </div>
                        </div>
                        <button type="button" class="btn btn-secondary"
                                onclick="review_callback($('#papers-input').val(), $('#sents-input').val());">
                            Generate
                        </button>
                        <div class="mt-3" id="feedback-review-form"></div>
                    </div>
                </div>
            {% endif %}

            <div class="mt-3 ml-3" id="log">
                <a class="btn btn-light mr-1" data-toggle="collapse" href="#collapseLog"
                   role="button" aria-expanded="false"
                   aria-controls="collapseCocitations">
                    Logs
                </a>
                <a href="javascript:void(0);"
                   class="btn btn-light"
                   role="button" onclick="export_data();">
                    Export
                </a>
                <div id="collapseLog" class="card-body collapse">
                    <pre>{{ log }}</pre>
                </div>
            </div>
        </main>

        <!--Right alignment-->
        <div class="d-none d-xl-block col-xl-2"></div>
    </div>
</div>
<footer>
    <p>version <a href="https://github.com/JetBrains-Research/pubtrends/blob/master/CHANGES.md" title="{{ version }}"
                  target="_blank">{{ version }}</a><br/>
        &copy; 2021-2025 <a href="https://research.jetbrains.org/groups/biolabs"
                            title="JetBrains Research BioLabs"
                            target="_blank">JetBrains Research</a></p>
</footer>
</body>
</html>